var WEB_SOCKET_DEBUG=false,WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=true,PushClient=function(a){this.timeout_id=this.params=this.connection=this.password=this.jid=null;this.retries=0;this.closing=false;this.defaults={flash_location:"WebSocketMain.swf",connect_timeout:3E3,connect_delay:0,connect_retry:10,rebind:true,debug:false,num_old:0,on_strophe_event:function(){},publish:function(){},retract:function(){},cookie_opts:{}};this.params=function(b,c){for(var e in c)if(c.hasOwnProperty(e))b[e]=c[e];return b}(this.defaults,
a);if(!this.params.pubsub_domain)this.params.pubsub_domain="pubsub."+this.params.domain;a=this.params.nodes;if(a.length>0)this.scope=MD5.hexdigest(a.join("-"));this.console=window.console;if(!this.params.debug||!console||!console.log||!console.error)this.console={log:function(){},error:function(){}};if(this.params.debug)window.WEB_SOCKET_DEBUG=true;window.WEB_SOCKET_SWF_LOCATION=this.params.flash_location;window.WebSocket&&window.WebSocket.__initialize&&window.WebSocket.__initialize();return this};
PushClient.connect=function(a){if(!this.push_client){this.push_client=new PushClient(a);this.push_client.connect()}return this.push_client};PushClient.disconnect=function(){var a=this;this.push_client.disconnect(function(){delete a.push_client})};PushClient.addChannel=function(a){if(this.push_client){if(typeof a==="string")a=[a];var b=this.push_client.params.nodes;this.merge(b,a);if(b.length>0)this.push_client.scope=MD5.hexdigest(b.join("-"));this.push_client.subscribe(a)}};
PushClient.removeChannel=function(a){if(this.push_client){if(typeof a==="string")a=[a];var b=PushClient.diff(this.push_client.params.nodes,channel);if(b.length>0)this.push_client.scope=MD5.hexdigest(b.join("-"));this.push_client.unsubscribe(a)}};PushClient.COOKIE="session";PushClient.couldRebind=function(){var a=["WEBSOCKET","BOSH"];for(p in a){var b=PushClient.COOKIE+"_"+a[p];this.console.log(a[p]);return window.sessionStorage?!!sessionStorage[b]:!!this.cookie(b)}};
PushClient.merge=function(a,b){var c=a.length,e=0;if(typeof b.length==="number")for(var f=b.length;e<f;e++)a[c++]=b[e];else for(;b[e]!==undefined;)a[c++]=b[e++];a.length=c;return a};PushClient.diff=function(a,b){return a.filter(function(c){return!(b.indexOf(c)>-1)})};
function FABridge(a,b){this.target=a;this.remoteTypeCache={};this.remoteInstanceCache={};this.remoteFunctionCache={};this.localFunctionCache={};this.bridgeID=FABridge.nextBridgeID++;this.name=b;this.nextLocalFuncID=0;FABridge.instances[this.name]=this;FABridge.idMap[this.bridgeID]=this;return this}FABridge.TYPE_ASINSTANCE=1;FABridge.TYPE_ASFUNCTION=2;FABridge.TYPE_JSFUNCTION=3;FABridge.TYPE_ANONYMOUS=4;FABridge.initCallbacks={};FABridge.userTypes={};
FABridge.addToUserTypes=function(){for(var a=0;a<arguments.length;a++)FABridge.userTypes[arguments[a]]={typeName:arguments[a],enriched:false}};FABridge.argsToArray=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b};function instanceFactory(a){this.fb_instance_id=a;return this}function FABridge__invokeJSFunction(a){var b=a[0];a=a.concat();a.shift();return FABridge.extractBridgeFromID(b).invokeLocalFunction(b,a)}
FABridge.addInitializationCallback=function(a,b){var c=FABridge.instances[a];if(c!=undefined)b.call(c);else{c=FABridge.initCallbacks[a];if(c==null)FABridge.initCallbacks[a]=c=[];c.push(b)}};
function FABridge__bridgeInitialized(a){var b=document.getElementsByTagName("object"),c=b.length,e=[];if(c>0)for(var f=0;f<c;f++)if(typeof b[f].SetVariable!="undefined")e[e.length]=b[f];c=document.getElementsByTagName("embed");f=c.length;b=[];if(f>0)for(var g=0;g<f;g++)if(typeof c[g].SetVariable!="undefined")b[b.length]=c[g];g=e.length;c=b.length;f="bridgeName="+a;if(g==1&&!c||g==1&&c==1)FABridge.attachBridge(e[0],a);else if(c==1&&!g)FABridge.attachBridge(b[0],a);else{var d=false;if(g>1)for(var h=
0;h<g;h++){for(var l=e[h].childNodes,s=0;s<l.length;s++){var y=l[s];if(y.nodeType==1&&y.tagName.toLowerCase()=="param"&&y.name.toLowerCase()=="flashvars"&&y.value.indexOf(f)>=0){FABridge.attachBridge(e[h],a);d=true;break}}if(d)break}if(!d&&c>1)for(e=0;e<c;e++)if(b[e].attributes.getNamedItem("flashVars").nodeValue.indexOf(f)>=0){FABridge.attachBridge(b[e],a);break}}return true}FABridge.nextBridgeID=0;FABridge.instances={};FABridge.idMap={};FABridge.refCount=0;
FABridge.extractBridgeFromID=function(a){return FABridge.idMap[a>>16]};FABridge.attachBridge=function(a,b){var c=new FABridge(a,b);FABridge[b]=c;var e=FABridge.initCallbacks[b];if(e!=null){for(var f=0;f<e.length;f++)e[f].call(c);delete FABridge.initCallbacks[b]}};FABridge.blockedMethods={toString:true,get:true,set:true,call:true};
FABridge.prototype={root:function(){return this.deserialize(this.target.getRoot())},releaseASObjects:function(){return this.target.releaseASObjects()},releaseNamedASObject:function(a){return typeof a!="object"?false:this.target.releaseNamedASObject(a.fb_instance_id)},create:function(a){return this.deserialize(this.target.create(a))},makeID:function(a){return(this.bridgeID<<16)+a},getPropertyFromAS:function(a,b){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");
else{FABridge.refCount++;retVal=this.target.getPropFromAS(a,b);retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},setPropertyInAS:function(a,b,c){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{FABridge.refCount++;retVal=this.target.setPropInAS(a,b,this.serialize(c));retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},
callASFunction:function(a,b){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");else{FABridge.refCount++;retVal=this.target.invokeASFunction(a,this.serialize(b));retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},callASMethod:function(a,b,c){if(FABridge.refCount>0)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");
else{FABridge.refCount++;c=this.serialize(c);retVal=this.target.invokeASMethod(a,b,c);retVal=this.handleError(retVal);FABridge.refCount--;return retVal}},invokeLocalFunction:function(a,b){var c,e=this.localFunctionCache[a];if(e!=undefined)c=this.serialize(e.apply(null,this.deserialize(b)));return c},getTypeFromName:function(a){return this.remoteTypeCache[a]},createProxy:function(a,b){var c=this.getTypeFromName(b);instanceFactory.prototype=c;c=new instanceFactory(a);return this.remoteInstanceCache[a]=
c},getProxy:function(a){return this.remoteInstanceCache[a]},addTypeDataToCache:function(a){for(var b=new ASProxy(this,a.name),c=a.accessors,e=0;e<c.length;e++)this.addPropertyToType(b,c[e]);a=a.methods;for(e=0;e<a.length;e++)FABridge.blockedMethods[a[e]]==undefined&&this.addMethodToType(b,a[e]);return this.remoteTypeCache[b.typeName]=b},addPropertyToType:function(a,b){var c=b.charAt(0),e;if(c>="a"&&c<="z"){e="get"+c.toUpperCase()+b.substr(1);c="set"+c.toUpperCase()+b.substr(1)}else{e="get"+b;c="set"+
b}a[c]=function(f){this.bridge.setPropertyInAS(this.fb_instance_id,b,f)};a[e]=function(){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,b))}},addMethodToType:function(a,b){a[b]=function(){return this.bridge.deserialize(this.bridge.callASMethod(this.fb_instance_id,b,FABridge.argsToArray(arguments)))}},getFunctionProxy:function(a){var b=this;if(this.remoteFunctionCache[a]==null)this.remoteFunctionCache[a]=function(){b.callASFunction(a,FABridge.argsToArray(arguments))};
return this.remoteFunctionCache[a]},getFunctionID:function(a){if(a.__bridge_id__==undefined){a.__bridge_id__=this.makeID(this.nextLocalFuncID++);this.localFunctionCache[a.__bridge_id__]=a}return a.__bridge_id__},serialize:function(a){var b={},c=typeof a;if(c=="number"||c=="string"||c=="boolean"||c==null||c==undefined)b=a;else if(a instanceof Array){b=[];for(c=0;c<a.length;c++)b[c]=this.serialize(a[c])}else if(c=="function"){b.type=FABridge.TYPE_JSFUNCTION;b.value=this.getFunctionID(a)}else if(a instanceof
ASProxy){b.type=FABridge.TYPE_ASINSTANCE;b.value=a.fb_instance_id}else{b.type=FABridge.TYPE_ANONYMOUS;b.value=a}return b},deserialize:function(a){var b,c=typeof a;if(c=="number"||c=="string"||c=="boolean"||a==null||a==undefined)b=this.handleError(a);else if(a instanceof Array){b=[];for(c=0;c<a.length;c++)b[c]=this.deserialize(a[c])}else if(c=="object"){for(c=0;c<a.newTypes.length;c++)this.addTypeDataToCache(a.newTypes[c]);for(var e in a.newRefs)this.createProxy(e,a.newRefs[e]);if(a.type==FABridge.TYPE_PRIMITIVE)b=
a.value;else if(a.type==FABridge.TYPE_ASFUNCTION)b=this.getFunctionProxy(a.value);else if(a.type==FABridge.TYPE_ASINSTANCE)b=this.getProxy(a.value);else if(a.type==FABridge.TYPE_ANONYMOUS)b=a.value}return b},addRef:function(a){this.target.incRef(a.fb_instance_id)},release:function(a){this.target.releaseRef(a.fb_instance_id)},handleError:function(a){if(typeof a=="string"&&a.indexOf("__FLASHERROR")==0){a=a.split("||");FABridge.refCount>0&&FABridge.refCount--;throw Error(a[1]);}return a}};
ASProxy=function(a,b){this.bridge=a;this.typeName=b;return this};ASProxy.prototype={get:function(a){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,a))},set:function(a,b){this.bridge.setPropertyInAS(this.fb_instance_id,a,b)},call:function(a,b){this.bridge.callASMethod(this.fb_instance_id,a,b)},addRef:function(){this.bridge.addRef(this)},release:function(){this.bridge.release(this)}};
(function(){if(!window.WebSocket)window.swfobject=function(){function a(){if(!N){try{var i=z.getElementsByTagName("body")[0].appendChild(z.createElement("span"));i.parentNode.removeChild(i)}catch(o){return}N=true;i=S.length;for(var r=0;r<i;r++)S[r]()}}function b(i){if(N)i();else S[S.length]=i}function c(i){if(typeof G.addEventListener!=C)G.addEventListener("load",i,false);else if(typeof z.addEventListener!=C)z.addEventListener("load",i,false);else if(typeof G.attachEvent!=C)j(G,"onload",i);else if(typeof G.onload==
"function"){var o=G.onload;G.onload=function(){o();i()}}else G.onload=i}function e(){var i=z.getElementsByTagName("body")[0],o=z.createElement(F);o.setAttribute("type",O);var r=i.appendChild(o);if(r){var v=0;(function(){if(typeof r.GetVariable!=C){var w=r.GetVariable("$version");if(w){w=w.split(" ")[1].split(",");x.pv=[parseInt(w[0],10),parseInt(w[1],10),parseInt(w[2],10)]}}else if(v<10){v++;setTimeout(arguments.callee,10);return}i.removeChild(o);r=null;f()})()}else f()}function f(){var i=K.length;
if(i>0)for(var o=0;o<i;o++){var r=K[o].id,v=K[o].callbackFn,w={success:false,id:r};if(x.pv[0]>0){var B=u(r);if(B)if(n(K[o].swfVersion)&&!(x.wk&&x.wk<312)){q(r,true);if(v){w.success=true;w.ref=g(r);v(w)}}else if(K[o].expressInstall&&d()){w={};w.data=K[o].expressInstall;w.width=B.getAttribute("width")||"0";w.height=B.getAttribute("height")||"0";if(B.getAttribute("class"))w.styleclass=B.getAttribute("class");if(B.getAttribute("align"))w.align=B.getAttribute("align");var A={};B=B.getElementsByTagName("param");
for(var D=B.length,E=0;E<D;E++)if(B[E].getAttribute("name").toLowerCase()!="movie")A[B[E].getAttribute("name")]=B[E].getAttribute("value");h(w,A,r,v)}else{l(B);v&&v(w)}}else{q(r,true);if(v){if((r=g(r))&&typeof r.SetVariable!=C){w.success=true;w.ref=r}v(w)}}}}function g(i){var o=null;if((i=u(i))&&i.nodeName=="OBJECT")if(typeof i.SetVariable!=C)o=i;else if(i=i.getElementsByTagName(F)[0])o=i;return o}function d(){return!T&&n("6.0.65")&&(x.win||x.mac)&&!(x.wk&&x.wk<312)}function h(i,o,r,v){T=true;Z=v||
null;aa={success:false,id:r};var w=u(r);if(w){if(w.nodeName=="OBJECT"){Q=s(w);U=null}else{Q=w;U=r}i.id=t;if(typeof i.width==C||!/%$/.test(i.width)&&parseInt(i.width,10)<310)i.width="310";if(typeof i.height==C||!/%$/.test(i.height)&&parseInt(i.height,10)<137)i.height="137";z.title=z.title.slice(0,47)+" - Flash Player Installation";v=x.ie&&x.win?"ActiveX":"PlugIn";v="MMredirectURL="+G.location.toString().replace(/&/g,"%26")+"&MMplayerType="+v+"&MMdoctitle="+z.title;if(typeof o.flashvars!=C)o.flashvars+=
"&"+v;else o.flashvars=v;if(x.ie&&x.win&&w.readyState!=4){v=z.createElement("div");r+="SWFObjectNew";v.setAttribute("id",r);w.parentNode.insertBefore(v,w);w.style.display="none";(function(){w.readyState==4?w.parentNode.removeChild(w):setTimeout(arguments.callee,10)})()}y(i,o,r)}}function l(i){if(x.ie&&x.win&&i.readyState!=4){var o=z.createElement("div");i.parentNode.insertBefore(o,i);o.parentNode.replaceChild(s(i),o);i.style.display="none";(function(){i.readyState==4?i.parentNode.removeChild(i):setTimeout(arguments.callee,
10)})()}else i.parentNode.replaceChild(s(i),i)}function s(i){var o=z.createElement("div");if(x.win&&x.ie)o.innerHTML=i.innerHTML;else if(i=i.getElementsByTagName(F)[0])if(i=i.childNodes)for(var r=i.length,v=0;v<r;v++)!(i[v].nodeType==1&&i[v].nodeName=="PARAM")&&i[v].nodeType!=8&&o.appendChild(i[v].cloneNode(true));return o}function y(i,o,r){var v,w=u(r);if(x.wk&&x.wk<312)return v;if(w){if(typeof i.id==C)i.id=r;if(x.ie&&x.win){var B="",A;for(A in i)if(i[A]!=Object.prototype[A])if(A.toLowerCase()==
"data")o.movie=i[A];else if(A.toLowerCase()=="styleclass")B+=' class="'+i[A]+'"';else if(A.toLowerCase()!="classid")B+=" "+A+'="'+i[A]+'"';A="";for(var D in o)if(o[D]!=Object.prototype[D])A+='<param name="'+D+'" value="'+o[D]+'" />';w.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+B+">"+A+"</object>";V[V.length]=i.id;v=u(i.id)}else{D=z.createElement(F);D.setAttribute("type",O);for(var E in i)if(i[E]!=Object.prototype[E])if(E.toLowerCase()=="styleclass")D.setAttribute("class",
i[E]);else E.toLowerCase()!="classid"&&D.setAttribute(E,i[E]);for(B in o)if(o[B]!=Object.prototype[B]&&B.toLowerCase()!="movie"){i=D;A=B;E=o[B];r=z.createElement("param");r.setAttribute("name",A);r.setAttribute("value",E);i.appendChild(r)}w.parentNode.replaceChild(D,w);v=D}}return v}function k(i){var o=u(i);if(o&&o.nodeName=="OBJECT")if(x.ie&&x.win){o.style.display="none";(function(){if(o.readyState==4){var r=u(i);if(r){for(var v in r)if(typeof r[v]=="function")r[v]=null;r.parentNode.removeChild(r)}}else setTimeout(arguments.callee,
10)})()}else o.parentNode.removeChild(o)}function u(i){var o=null;try{o=z.getElementById(i)}catch(r){}return o}function j(i,o,r){i.attachEvent(o,r);P[P.length]=[i,o,r]}function n(i){var o=x.pv;i=i.split(".");i[0]=parseInt(i[0],10);i[1]=parseInt(i[1],10)||0;i[2]=parseInt(i[2],10)||0;return o[0]>i[0]||o[0]==i[0]&&o[1]>i[1]||o[0]==i[0]&&o[1]==i[1]&&o[2]>=i[2]?true:false}function m(i,o,r,v){if(!(x.ie&&x.mac)){var w=z.getElementsByTagName("head")[0];if(w){r=r&&typeof r=="string"?r:"screen";if(v)$=I=null;
if(!I||$!=r){v=z.createElement("style");v.setAttribute("type","text/css");v.setAttribute("media",r);I=w.appendChild(v);if(x.ie&&x.win&&typeof z.styleSheets!=C&&z.styleSheets.length>0)I=z.styleSheets[z.styleSheets.length-1];$=r}if(x.ie&&x.win)I&&typeof I.addRule==F&&I.addRule(i,o);else I&&typeof z.createTextNode!=C&&I.appendChild(z.createTextNode(i+" {"+o+"}"))}}}function q(i,o){if(ba){var r=o?"visible":"hidden";if(N&&u(i))u(i).style.visibility=r;else m("#"+i,"visibility:"+r)}}function H(i){return/[\\\"<>\.;]/.exec(i)!=
null&&typeof encodeURIComponent!=C?encodeURIComponent(i):i}var C="undefined",F="object",O="application/x-shockwave-flash",t="SWFObjectExprInst",G=window,z=document,L=navigator,ca=false,S=[function(){ca?e():f()}],K=[],V=[],P=[],Q,U,Z,aa,N=false,T=false,I,$,ba=true,x=function(){var i=typeof z.getElementById!=C&&typeof z.getElementsByTagName!=C&&typeof z.createElement!=C,o=L.userAgent.toLowerCase(),r=L.platform.toLowerCase(),v=r?/win/.test(r):/win/.test(o);r=r?/mac/.test(r):/mac/.test(o);o=/webkit/.test(o)?
parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false;var w=!+"\u000b1",B=[0,0,0],A=null;if(typeof L.plugins!=C&&typeof L.plugins["Shockwave Flash"]==F){if((A=L.plugins["Shockwave Flash"].description)&&!(typeof L.mimeTypes!=C&&L.mimeTypes[O]&&!L.mimeTypes[O].enabledPlugin)){ca=true;w=false;A=A.replace(/^.*\s+(\S+\s+\S+$)/,"$1");B[0]=parseInt(A.replace(/^(.*)\..*$/,"$1"),10);B[1]=parseInt(A.replace(/^.*\.(.*)\s.*$/,"$1"),10);B[2]=/[a-zA-Z]/.test(A)?parseInt(A.replace(/^.*[a-zA-Z]+(.*)$/,
"$1"),10):0}}else if(typeof G.ActiveXObject!=C)try{var D=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(D)if(A=D.GetVariable("$version")){w=true;A=A.split(" ")[1].split(",");B=[parseInt(A[0],10),parseInt(A[1],10),parseInt(A[2],10)]}}catch(E){}return{w3:i,pv:B,wk:o,ie:w,win:v,mac:r}}();(function(){if(x.w3){if(typeof z.readyState!=C&&z.readyState=="complete"||typeof z.readyState==C&&(z.getElementsByTagName("body")[0]||z.body))a();if(!N){typeof z.addEventListener!=C&&z.addEventListener("DOMContentLoaded",
a,false);if(x.ie&&x.win){z.attachEvent("onreadystatechange",function(){if(z.readyState=="complete"){z.detachEvent("onreadystatechange",arguments.callee);a()}});G==top&&function(){if(!N){try{z.documentElement.doScroll("left")}catch(i){setTimeout(arguments.callee,0);return}a()}}()}x.wk&&function(){N||(/loaded|complete/.test(z.readyState)?a():setTimeout(arguments.callee,0))}();c(a)}}})();(function(){x.ie&&x.win&&window.attachEvent("onunload",function(){for(var i=P.length,o=0;o<i;o++)P[o][0].detachEvent(P[o][1],
P[o][2]);i=V.length;for(o=0;o<i;o++)k(V[o]);for(var r in x)x[r]=null;x=null;for(var v in swfobject)swfobject[v]=null;swfobject=null})})();return{registerObject:function(i,o,r,v){if(x.w3&&i&&o){var w={};w.id=i;w.swfVersion=o;w.expressInstall=r;w.callbackFn=v;K[K.length]=w;q(i,false)}else v&&v({success:false,id:i})},getObjectById:function(i){if(x.w3)return g(i)},embedSWF:function(i,o,r,v,w,B,A,D,E,R){var W={success:false,id:o};if(x.w3&&!(x.wk&&x.wk<312)&&i&&o&&r&&v&&w){q(o,false);b(function(){r+="";
v+="";var M={};if(E&&typeof E===F)for(var J in E)M[J]=E[J];M.data=i;M.width=r;M.height=v;J={};if(D&&typeof D===F)for(var X in D)J[X]=D[X];if(A&&typeof A===F)for(var Y in A)if(typeof J.flashvars!=C)J.flashvars+="&"+Y+"="+A[Y];else J.flashvars=Y+"="+A[Y];if(n(w)){X=y(M,J,o);M.id==o&&q(o,true);W.success=true;W.ref=X}else if(B&&d()){M.data=B;h(M,J,o,R);return}else q(o,true);R&&R(W)})}else R&&R(W)},switchOffAutoHideShow:function(){ba=false},ua:x,getFlashPlayerVersion:function(){return{major:x.pv[0],minor:x.pv[1],
release:x.pv[2]}},hasFlashPlayerVersion:n,createSWF:function(i,o,r){if(x.w3)return y(i,o,r)},showExpressInstall:function(i,o,r,v){x.w3&&d()&&h(i,o,r,v)},removeSWF:function(i){x.w3&&k(i)},createCSS:function(i,o,r,v){x.w3&&m(i,o,r,v)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(i){var o=z.location.search||z.location.hash;if(o){if(/\?/.test(o))o=o.split("?")[1];if(i==null)return H(o);o=o.split("&");for(var r=0;r<o.length;r++)if(o[r].substring(0,o[r].indexOf("="))==i)return H(o[r].substring(o[r].indexOf("=")+
1))}return""},expressInstallCallback:function(){if(T){var i=u(t);if(i&&Q){i.parentNode.replaceChild(Q,i);if(U){q(U,true);if(x.ie&&x.win)Q.style.display="block"}Z&&Z(aa)}T=false}}}}()})();
(function(){function a(){}if(!window.WebSocket){var b=window.console;if(!b||!b.log||!b.error)b={log:function(){},error:function(){}};if(swfobject.hasFlashPlayerVersion("9.0.0")){location.protocol=="file:"&&window.WEB_SOCKET_DEBUG&&b.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...");WebSocket=function(c,e,f,g,d){var h=this;h.readyState=WebSocket.CONNECTING;h.bufferedAmount=0;setTimeout(function(){WebSocket.__addTask(function(){h.__createFlash(c,
e,f,g,d)})},0)};WebSocket.prototype.__createFlash=function(c,e,f,g,d){var h=this;h.__flash=WebSocket.__flash.create(c,e,f||null,g||0,d||null);h.__flash.addEventListener("event",function(){setTimeout(function(){h.__handleEvents()},0)})};WebSocket.prototype.send=function(c){if(!this.__flash||this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";c=this.__flash.send(encodeURIComponent(c));if(c<0)return true;else{this.bufferedAmount+=c;return false}};
WebSocket.prototype.close=function(){if(this.__flash)if(!(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)){this.__flash.close();this.readyState=WebSocket.CLOSED;this.__timer&&clearInterval(this.__timer);this.onclose&&setTimeout(this.onclose,0)}};WebSocket.prototype.addEventListener=function(c,e){if(!("__events"in this))this.__events={};if(!(c in this.__events)){this.__events[c]=[];if("function"==typeof this["on"+c]){this.__events[c].defaultHandler=this["on"+c];this["on"+c]=
this.__createEventHandler(this,c)}}this.__events[c].push(e)};WebSocket.prototype.removeEventListener=function(c,e){if(!("__events"in this))this.__events={};if(c in this.__events)for(var f=this.__events.length;f>-1;--f)if(e===this.__events[c][f]){this.__events[c].splice(f,1);break}};WebSocket.prototype.dispatchEvent=function(c){if(!("__events"in this))throw"UNSPECIFIED_EVENT_TYPE_ERR";if(!(c.type in this.__events))throw"UNSPECIFIED_EVENT_TYPE_ERR";for(var e=0,f=this.__events[c.type].length;e<f;++e){this.__events[c.type][e](c);
if(c.cancelBubble)break}false!==c.returnValue&&"function"==typeof this.__events[c.type].defaultHandler&&this.__events[c.type].defaultHandler(c)};WebSocket.prototype.__handleEvents=function(){for(var c=this.__flash.receiveEvents(),e=0;e<c.length;e++)try{var f=c[e];if("readyState"in f)this.readyState=f.readyState;if(f.type=="open"){this.__timer&&clearInterval(this.__timer);if(window.opera){var g=this;this.__timer=setInterval(function(){g.__handleEvents()},500)}this.onopen&&this.onopen()}else if(f.type==
"close"){this.__timer&&clearInterval(this.__timer);this.onclose&&this.onclose()}else if(f.type=="message"){if(this.onmessage){var d=decodeURIComponent(f.data),h;if(window.MessageEvent&&!window.opera){h=document.createEvent("MessageEvent");h.initMessageEvent("message",false,false,d,null,null,window,null)}else h={data:d};this.onmessage(h)}}else if(f.type=="error"){this.__timer&&clearInterval(this.__timer);this.onerror&&this.onerror()}else throw"unknown event type: "+f.type;}catch(l){window.WEB_SOCKET_DEBUG&&
b.error(l.toString())}};WebSocket.prototype.__createEventHandler=function(c,e){return function(f){var g=new a;g.initEvent(e,true,true);g.target=g.currentTarget=c;for(var d in f)g[d]=f[d];c.dispatchEvent(g,arguments)}};a.prototype.cancelable=true;a.prototype.cancelBubble=false;a.prototype.preventDefault=function(){if(this.cancelable)this.returnValue=false};a.prototype.stopPropagation=function(){this.cancelBubble=true};a.prototype.initEvent=function(c,e,f){this.type=c;this.cancelable=f;this.timeStamp=
new Date};WebSocket.CONNECTING=0;WebSocket.OPEN=1;WebSocket.CLOSING=2;WebSocket.CLOSED=3;WebSocket.__tasks=[];WebSocket.loadFlashPolicyFile=function(c){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(c)})};WebSocket.__initialize=function(){if(WebSocket.__swfLocation)window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation;if(window.WEB_SOCKET_SWF_LOCATION){var c=document.createElement("div");c.id="webSocketContainer";c.style.position="absolute";c.style.width="1";c.style.height=
"1";if(WebSocket.__isFlashLite()){c.style.left="0px";c.style.top="0px"}else{c.style.left="-100px";c.style.top="-100px"}var e=document.createElement("div");e.id="webSocketFlash";c.appendChild(e);document.body.appendChild(c);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","9.0.0",null,{bridgeName:"webSocket"},{hasPriority:true,allowScriptAccess:"always"},null,function(f){!f.success&&window.WEB_SOCKET_DEBUG&&b.error("[WebSocket] swfobject.embedSWF failed")});FABridge.addInitializationCallback("webSocket",
function(){try{WebSocket.__flash=FABridge.webSocket.root();WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var f=0;f<WebSocket.__tasks.length;++f)WebSocket.__tasks[f]();WebSocket.__tasks=[]}catch(g){window.WEB_SOCKET_DEBUG&&b.error("[WebSocket] "+g.toString())}})}else window.WEB_SOCKET_DEBUG&&b.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")};WebSocket.__addTask=function(c){WebSocket.__flash?c():WebSocket.__tasks.push(c)};
WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return false;var c=window.navigator.mimeTypes["application/x-shockwave-flash"];if(!c||!c.enabledPlugin||!c.enabledPlugin.filename)return false;return c.enabledPlugin.filename.match(/flashlite/i)?true:false};window.webSocketLog=function(c){window.WEB_SOCKET_DEBUG&&b.log(decodeURIComponent(c))};window.webSocketError=function(c){window.WEB_SOCKET_DEBUG&&b.error(decodeURIComponent(c))};window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||
(window.addEventListener?window.addEventListener("load",WebSocket.__initialize,false):window.attachEvent("onload",WebSocket.__initialize))}else window.WEB_SOCKET_DEBUG&&b.error("Flash Player is not installed.")}})();
var Base64=function(){return{encode:function(a){var b="",c,e,f,g,d,h,l=0;do{c=a.charCodeAt(l++);e=a.charCodeAt(l++);f=a.charCodeAt(l++);g=c>>2;c=(c&3)<<4|e>>4;d=(e&15)<<2|f>>6;h=f&63;if(isNaN(e))d=h=64;else if(isNaN(f))h=64;b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)}while(l<
a.length);return b},decode:function(a){var b="",c,e,f,g,d,h=0;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++));e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++));g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++));d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(h++));c=c<<2|e>>4;e=(e&15)<<4|g>>
2;f=(g&3)<<6|d;b+=String.fromCharCode(c);if(g!=64)b+=String.fromCharCode(e);if(d!=64)b+=String.fromCharCode(f)}while(h<a.length);return b}}}(),MD5=function(){var a=function(k,u){var j=(k&65535)+(u&65535);return(k>>16)+(u>>16)+(j>>16)<<16|j&65535},b=function(k){for(var u=[],j=0;j<k.length*8;j+=8)u[j>>5]|=(k.charCodeAt(j/8)&255)<<j%32;return u},c=function(k){for(var u="",j=0;j<k.length*32;j+=8)u+=String.fromCharCode(k[j>>5]>>>j%32&255);return u},e=function(k){for(var u="",j=0;j<k.length*4;j++)u+="0123456789abcdef".charAt(k[j>>
2]>>j%4*8+4&15)+"0123456789abcdef".charAt(k[j>>2]>>j%4*8&15);return u},f=function(k){for(var u="",j,n,m=0;m<k.length*4;m+=3){j=(k[m>>2]>>8*(m%4)&255)<<16|(k[m+1>>2]>>8*((m+1)%4)&255)<<8|k[m+2>>2]>>8*((m+2)%4)&255;for(n=0;n<4;n++)u+=m*8+n*6>k.length*32?"":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(j>>6*(3-n)&63)}return u},g=function(k,u,j,n,m,q){k=a(a(u,k),a(n,q));return a(k<<m|k>>>32-m,j)},d=function(k,u,j,n,m,q,H){return g(u&j|~u&n,k,u,m,q,H)},h=function(k,u,j,n,m,
q,H){return g(u&n|j&~n,k,u,m,q,H)},l=function(k,u,j,n,m,q,H){return g(j^(u|~n),k,u,m,q,H)},s=function(k,u){k[u>>5]|=128<<u%32;k[(u+64>>>9<<4)+14]=u;for(var j=1732584193,n=-271733879,m=-1732584194,q=271733878,H,C,F,O,t=0;t<k.length;t+=16){H=j;C=n;F=m;O=q;j=d(j,n,m,q,k[t+0],7,-680876936);q=d(q,j,n,m,k[t+1],12,-389564586);m=d(m,q,j,n,k[t+2],17,606105819);n=d(n,m,q,j,k[t+3],22,-1044525330);j=d(j,n,m,q,k[t+4],7,-176418897);q=d(q,j,n,m,k[t+5],12,1200080426);m=d(m,q,j,n,k[t+6],17,-1473231341);n=d(n,m,q,
j,k[t+7],22,-45705983);j=d(j,n,m,q,k[t+8],7,1770035416);q=d(q,j,n,m,k[t+9],12,-1958414417);m=d(m,q,j,n,k[t+10],17,-42063);n=d(n,m,q,j,k[t+11],22,-1990404162);j=d(j,n,m,q,k[t+12],7,1804603682);q=d(q,j,n,m,k[t+13],12,-40341101);m=d(m,q,j,n,k[t+14],17,-1502002290);n=d(n,m,q,j,k[t+15],22,1236535329);j=h(j,n,m,q,k[t+1],5,-165796510);q=h(q,j,n,m,k[t+6],9,-1069501632);m=h(m,q,j,n,k[t+11],14,643717713);n=h(n,m,q,j,k[t+0],20,-373897302);j=h(j,n,m,q,k[t+5],5,-701558691);q=h(q,j,n,m,k[t+10],9,38016083);m=h(m,
q,j,n,k[t+15],14,-660478335);n=h(n,m,q,j,k[t+4],20,-405537848);j=h(j,n,m,q,k[t+9],5,568446438);q=h(q,j,n,m,k[t+14],9,-1019803690);m=h(m,q,j,n,k[t+3],14,-187363961);n=h(n,m,q,j,k[t+8],20,1163531501);j=h(j,n,m,q,k[t+13],5,-1444681467);q=h(q,j,n,m,k[t+2],9,-51403784);m=h(m,q,j,n,k[t+7],14,1735328473);n=h(n,m,q,j,k[t+12],20,-1926607734);j=g(n^m^q,j,n,k[t+5],4,-378558);q=g(j^n^m,q,j,k[t+8],11,-2022574463);m=g(q^j^n,m,q,k[t+11],16,1839030562);n=g(m^q^j,n,m,k[t+14],23,-35309556);j=g(n^m^q,j,n,k[t+1],4,-1530992060);
q=g(j^n^m,q,j,k[t+4],11,1272893353);m=g(q^j^n,m,q,k[t+7],16,-155497632);n=g(m^q^j,n,m,k[t+10],23,-1094730640);j=g(n^m^q,j,n,k[t+13],4,681279174);q=g(j^n^m,q,j,k[t+0],11,-358537222);m=g(q^j^n,m,q,k[t+3],16,-722521979);n=g(m^q^j,n,m,k[t+6],23,76029189);j=g(n^m^q,j,n,k[t+9],4,-640364487);q=g(j^n^m,q,j,k[t+12],11,-421815835);m=g(q^j^n,m,q,k[t+15],16,530742520);n=g(m^q^j,n,m,k[t+2],23,-995338651);j=l(j,n,m,q,k[t+0],6,-198630844);q=l(q,j,n,m,k[t+7],10,1126891415);m=l(m,q,j,n,k[t+14],15,-1416354905);n=l(n,
m,q,j,k[t+5],21,-57434055);j=l(j,n,m,q,k[t+12],6,1700485571);q=l(q,j,n,m,k[t+3],10,-1894986606);m=l(m,q,j,n,k[t+10],15,-1051523);n=l(n,m,q,j,k[t+1],21,-2054922799);j=l(j,n,m,q,k[t+8],6,1873313359);q=l(q,j,n,m,k[t+15],10,-30611744);m=l(m,q,j,n,k[t+6],15,-1560198380);n=l(n,m,q,j,k[t+13],21,1309151649);j=l(j,n,m,q,k[t+4],6,-145523070);q=l(q,j,n,m,k[t+11],10,-1120210379);m=l(m,q,j,n,k[t+2],15,718787259);n=l(n,m,q,j,k[t+9],21,-343485551);j=a(j,H);n=a(n,C);m=a(m,F);q=a(q,O)}return[j,n,m,q]},y=function(k,
u){var j=b(k);if(j.length>16)j=s(j,k.length*8);for(var n=Array(16),m=Array(16),q=0;q<16;q++){n[q]=j[q]^909522486;m[q]=j[q]^1549556828}j=s(n.concat(b(u)),512+u.length*8);return s(m.concat(j),640)};return{hexdigest:function(k){return e(s(b(k),k.length*8))},b64digest:function(k){return f(s(b(k),k.length*8))},hash:function(k){return c(s(b(k),k.length*8))},hmac_hexdigest:function(k,u){return e(y(k,u))},hmac_b64digest:function(k,u){return f(y(k,u))},hmac_hash:function(k,u){return c(y(k,u))},test:function(){return MD5.hexdigest("abc")===
"900150983cd24fb0d6963f7d28e17f72"}}}();if(!Function.prototype.bind)Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a,arguments)}};if(!Function.prototype.prependArg)Function.prototype.prependArg=function(a){var b=this;return function(){for(var c=[a],e=0;e<arguments.length;e++)c.push(arguments[e]);return b.apply(this,c)}};
if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a,b){var c=this.length,e=Number(b)||0;e=e<0?Math.ceil(e):Math.floor(e);if(e<0)e+=c;for(;e<c;e++)if(e in this&&this[e]===a)return e;return-1};
(function(a){function b(d,h){return new g.Builder(d,h)}function c(d){return new g.Builder("message",d)}function e(d){return new g.Builder("iq",d)}function f(d){return new g.Builder("presence",d)}var g;g={VERSION:"2a276a4",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",
SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"},addNamespace:function(d,h){g.NS[d]=h},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3},TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,
forEachChild:function(d,h,l){var s,y;for(s=0;s<d.childNodes.length;s++){y=d.childNodes[s];if(y.nodeType==g.ElementType.NORMAL&&(!h||this.isTagEqual(y,h)))l(y)}},isTagEqual:function(d,h){return d.tagName.toLowerCase()==h.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var d;if(window.ActiveXObject){d=new ActiveXObject("Microsoft.XMLDOM");d.appendChild(d.createElement("strophe"))}else d=document.implementation.createDocument("jabber:client","strophe",null);return d},xmlElement:function(d){if(!d)return null;
var h=null;if(!g._xmlGenerator)g._xmlGenerator=g._makeGenerator();h=g._xmlGenerator.createElement(d);var l,s,y;for(l=1;l<arguments.length;l++)if(arguments[l])if(typeof arguments[l]=="string"||typeof arguments[l]=="number")h.appendChild(g.xmlTextNode(arguments[l]));else if(typeof arguments[l]=="object"&&typeof arguments[l].sort=="function")for(s=0;s<arguments[l].length;s++)typeof arguments[l][s]=="object"&&typeof arguments[l][s].sort=="function"&&h.setAttribute(arguments[l][s][0],arguments[l][s][1]);
else if(typeof arguments[l]=="object")for(y in arguments[l])arguments[l].hasOwnProperty(y)&&h.setAttribute(y,arguments[l][y]);return h},xmlescape:function(d){d=d.replace(/\&/g,"&amp;");d=d.replace(/</g,"&lt;");return d=d.replace(/>/g,"&gt;")},xmlTextNode:function(d){d=g.xmlescape(d);if(!g._xmlGenerator)g._xmlGenerator=g._makeGenerator();return g._xmlGenerator.createTextNode(d)},getText:function(d){if(!d)return null;var h="";if(d.childNodes.length===0&&d.nodeType==g.ElementType.TEXT)h+=d.nodeValue;
for(var l=0;l<d.childNodes.length;l++)if(d.childNodes[l].nodeType==g.ElementType.TEXT)h+=d.childNodes[l].nodeValue;return h},copyElement:function(d){var h,l;if(d.nodeType==g.ElementType.NORMAL){l=g.xmlElement(d.tagName);for(h=0;h<d.attributes.length;h++)l.setAttribute(d.attributes[h].nodeName.toLowerCase(),d.attributes[h].value);for(h=0;h<d.childNodes.length;h++)l.appendChild(g.copyElement(d.childNodes[h]))}else if(d.nodeType==g.ElementType.TEXT)l=g.xmlTextNode(d.nodeValue);return l},escapeNode:function(d){return d.replace(/^\s+|\s+$/g,
"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(d){return d.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(d){if(d.indexOf("@")<
0)return null;return d.split("@")[0]},getDomainFromJid:function(d){d=g.getBareJidFromJid(d);if(d.indexOf("@")<0)return d;else{d=d.split("@");d.splice(0,1);return d.join("@")}},getResourceFromJid:function(d){d=d.split("/");if(d.length<2)return null;d.splice(0,1);return d.join("/")},getBareJidFromJid:function(d){return d?d.split("/")[0]:null},log:function(){},debug:function(d){this.log(this.LogLevel.DEBUG,d)},info:function(d){this.log(this.LogLevel.INFO,d)},warn:function(d){this.log(this.LogLevel.WARN,
d)},error:function(d){this.log(this.LogLevel.ERROR,d)},fatal:function(d){this.log(this.LogLevel.FATAL,d)},serialize:function(d){var h;if(!d)return null;if(typeof d.tree==="function")d=d.tree();var l=d.nodeName,s,y;if(d.getAttribute("_realname"))l=d.getAttribute("_realname");h="<"+l;for(s=0;s<d.attributes.length;s++)if(d.attributes[s].nodeName!="_realname")h+=" "+d.attributes[s].nodeName.toLowerCase()+"='"+d.attributes[s].value.replace("&","&amp;").replace("'","&apos;").replace("<","&lt;")+"'";if(d.childNodes.length>
0){h+=">";for(s=0;s<d.childNodes.length;s++){y=d.childNodes[s];if(y.nodeType==g.ElementType.NORMAL)h+=g.serialize(y);else if(y.nodeType==g.ElementType.TEXT)h+=y.nodeValue}h+="</"+l+">"}else h+="/>";return h},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(d,h){g._connectionPlugins[d]=h}};g.Builder=function(d,h){if(d=="presence"||d=="message"||d=="iq")if(h&&!h.xmlns)h.xmlns=g.NS.CLIENT;else h||(h={xmlns:g.NS.CLIENT});this.node=this.nodeTree=g.xmlElement(d,h)};g.Builder.prototype={tree:function(){return this.nodeTree},
toString:function(){return g.serialize(this.nodeTree)},up:function(){this.node=this.node.parentNode;return this},attrs:function(d){for(var h in d)d.hasOwnProperty(h)&&this.node.setAttribute(h,d[h]);return this},c:function(d,h){var l=g.xmlElement(d,h);this.node.appendChild(l);this.node=l;return this},cnode:function(d){this.node.appendChild(d);this.node=d;return this},t:function(d){this.node.appendChild(g.xmlTextNode(d));return this}};g.Handler=function(d,h,l,s,y,k,u){this.handler=d;this.ns=h;this.name=
l;this.type=s;this.id=y;this.options=u||{matchbare:false};if(!this.options.matchBare)this.options.matchBare=false;this.from=this.options.matchBare?k?g.getBareJidFromJid(k):null:k;this.user=true};g.Handler.prototype={isMatch:function(d){var h,l=null;l=this.options.matchBare?g.getBareJidFromJid(d.getAttribute("from")):d.getAttribute("from");h=false;if(this.ns){var s=this;g.forEachChild(d,null,function(y){if(y.getAttribute("xmlns")==s.ns)h=true});h=h||d.getAttribute("xmlns")==this.ns}else h=true;if(h&&
(!this.name||g.isTagEqual(d,this.name))&&(!this.type||d.getAttribute("type")==this.type)&&(!this.id||d.getAttribute("id")==this.id)&&(!this.from||l==this.from))return true;return false},run:function(d){var h=null;try{h=this.handler(d)}catch(l){if(l.sourceURL)g.fatal("error: "+this.handler+" "+l.sourceURL+":"+l.line+" - "+l.name+": "+l.message);else if(l.fileName){if(typeof console!="undefined"){console.trace();console.error(this.handler," - error - ",l,l.message)}g.fatal("error: "+this.handler+" "+
l.fileName+":"+l.lineNumber+" - "+l.name+": "+l.message)}else g.fatal("error: "+this.handler);throw l;}return h},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};g.TimedHandler=function(d,h){this.period=d;this.handler=h;this.lastCalled=(new Date).getTime();this.user=true};g.TimedHandler.prototype={run:function(){this.lastCalled=(new Date).getTime();return this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+
this.handler+"("+this.period+")}"}};g.Request=function(d,h,l,s){this.id=++g._requestId;this.xmlData=d;this.data=g.serialize(d);this.func=this.origFunc=h;this.rid=l;this.date=NaN;this.sends=s||0;this.abort=false;this.dead=null;this.age=function(){if(!this.date)return 0;return(new Date-this.date)/1E3};this.timeDead=function(){if(!this.dead)return 0;return(new Date-this.dead)/1E3};this.xhr=this._newXHR()};g.Request.prototype={getResponse:function(){var d=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){d=
this.xhr.responseXML.documentElement;if(d.tagName=="parsererror"){g.error("invalid response received");g.error("responseText: "+this.xhr.responseText);g.error("responseXML: "+g.serialize(this.xhr.responseXML));throw"parsererror";}}else if(this.xhr.responseText){g.error("invalid response received");g.error("responseText: "+this.xhr.responseText);g.error("responseXML: "+g.serialize(this.xhr.responseXML))}return d},_newXHR:function(){var d=null;if(window.XMLHttpRequest){d=new XMLHttpRequest;d.overrideMimeType&&
d.overrideMimeType("text/xml")}else if(window.ActiveXObject)d=new ActiveXObject("Microsoft.XMLHTTP");d.onreadystatechange=this.func.prependArg(this);return d}};a&&a(g,b,c,e,f)})(function(a,b,c,e,f){window.Strophe=a;window.$build=b;window.$msg=c;window.$iq=e;window.$pres=f});Strophe.Status.REBINDFAILED=9;
Strophe.WebSocket=function(a){this.service=a;this.ws=null;this.connect_timeout=300;this.jid="";this.streamId=null;this.do_bind=this.do_session=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._disconnectTimeout=this._idleTimeout=null;this.connected=this.disconnecting=this.authenticated=false;this._keep_alive_timer=2E4;this.errors=0;this._data=[];this._requests=[];this._uniqueId=Math.round(Math.random()*1E4);this._rebind_failure_handler=
this._rebind_success_handler=this._sasl_challenge_handler=this._sasl_failure_handler=this._sasl_success_handler=null;this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var b in Strophe._connectionPlugins)if(Strophe._connectionPlugins.hasOwnProperty(b)){a=function(){};a.prototype=Strophe._connectionPlugins[b];this[b]=new a;this[b].init(this)}};
Strophe.WebSocket.prototype={reset:function(){this.streamId=this.sid=null;this.do_bind=this.do_session=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.connected=this.disconnecting=this.authenticated=false;this.errors=0},pause:function(){},resume:function(){},getUniqueId:function(a){return typeof a=="string"||typeof a=="number"?++this._uniqueId+":"+a:++this._uniqueId+""},connect:function(a,b,c){this.jid=a;this.pass=
b;this.connect_callback=c;this.authenticated=this.connected=this.disconnecting=false;this.errors=0;this.domain=Strophe.getDomainFromJid(this.jid);if(window.WebSocket)try{this.ws=new WebSocket(this.service);this.ws.onopen=this._send_initial_stream.bind(this);this._addSysTimedHandler(this._keep_alive_timer,this._keep_alive_handler.bind(this));this.ws.onmessage=this._get_stream_id.bind(this).prependArg(this._connect_cb.bind(this));this.ws.onerror=function(f){console.log("error : "+f)};this.ws.onclose=
this._ws_on_close.bind(this)}catch(e){}else throw"no websocket support";},attach:function(){},rebind:function(a,b,c){this.jid=a;this.connect_callback=c;this.domain=Strophe.getDomainFromJid(this.jid);this._addSysTimedHandler(this._keep_alive_timer,this._keep_alive_handler.bind(this));this.ws=new WebSocket(this.service);this.ws.onopen=this._send_initial_stream.bind(this);this.ws.onmessage=this._get_stream_id.bind(this).prependArg(this._rebind_cb.bind(this).prependArg(a).prependArg(b));this.ws.onclose=
this._ws_on_close.bind(this)},save:function(a,b){this.sendIQ($iq({type:"set"}).c("push",{xmlns:"p1:push"}).c("keepalive",{max:"30"}).up().c("session",{duration:"1"}),a,b)},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},send:function(a){var b="";if(a!==null){if(typeof a.sort==="function")for(var c=0;c<a.length;c++){b+=Strophe.serialize(a[c]);this.xmlOutput(a)}else if(typeof a.tree==="function"){b=Strophe.serialize(a.tree());this.xmlOutput(a.tree())}else{b=
Strophe.serialize(a);this.xmlOutput(a)}this.rawOutput(b);this.ws.send(b)}},flush:function(){},sendIQ:function(a,b,c,e){var f=null,g=this;if(typeof a.tree==="function")a=a.tree();var d=a.getAttribute("id");if(!d){d=this.getUniqueId("sendIQ");a.setAttribute("id",d)}var h=this.addHandler(function(l){f&&g.deleteTimedHandler(f);var s=l.getAttribute("type");if(s=="result")b&&b(l);else if(s=="error")c&&c(l);else throw{name:"StropheError",message:"Got bad IQ type of "+s};},null,"iq",null,d);if(e)f=this.addTimedHandler(e,
function(){g.deleteHandler(h);c&&c(null);return false});this.send(a);return d},addTimedHandler:function(a,b){var c=new Strophe.TimedHandler(a,b);this.addTimeds.push(c);return c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,c,e,f,g,d){a=new Strophe.Handler(a,b,c,e,f,g,d);this.addHandlers.push(a);return a},deleteHandler:function(a){this.removeHandlers.push(a)},disconnect:function(a){this._changeConnectStatus(Strophe.Status.DISCONNECTING,a);Strophe.info("Disconnect was called because: "+
a);if(this.connected){this._disconnectTimeout=this._addSysTimedHandler(3E3,this._onDisconnectTimeout.bind(this));this._sendTerminate()}},_changeConnectStatus:function(a,b){for(var c in Strophe._connectionPlugins)if(Strophe._connectionPlugins.hasOwnProperty(c)){var e=this[c];if(e.statusChanged)try{e.statusChanged(a,b)}catch(f){Strophe.error(""+c+" plugin caused an exception changing status: "+f)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(g){Strophe.error("User connection callback caused an exception: "+
g)}},_doDisconnect:function(){Strophe.info("_doDisconnect was called");this.disconnecting=this.authenticated=false;this.streamId=this.sid=null;if(this.connected){this._changeConnectStatus(Strophe.Status.DISCONNECTED,null);this.connected=false}this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.ws.readyState!=this.ws.CLOSED&&this.ws.close()},_ws_on_close:function(){Strophe.info("websocket closed");this._doDisconnect()},_keep_alive_handler:function(){this.ws.send("\n");
return true},_send_initial_stream:function(){this._changeConnectStatus(Strophe.Status.CONNECTING,null);var a='<?xml version="1.0"?><stream:stream xmlns:stream="http://etherx.jabber.org/streams" version="1.0" xmlns="jabber:client" to="'+this.domain+'" xml:lang="en" xmlns:xml="http://www.w3.org/XML/1998/namespace" >';this.rawOutput(a);this.ws.send(a)},_get_stream_id:function(a,b){elem=b.data;this.rawInput(elem);if(b.data.match(/id=[\'\"]([^\'\"]+)[\'\"]/))this.streamId=RegExp.$1;this.ws.onmessage=a},
_parseTree:function(a){try{if(this._xml_parse==undefined)if(window.DOMParser){this._xml_parser=new DOMParser;this._xml_parse=function(c){return this._xml_parser.parseFromString("<body xmlns:stream='foo' >"+c+"</body>","text/xml").documentElement.firstChild}}else this._xml_parse=function(c){var e=new ActiveXObject("MSXML2.DomDocument");e.async="false";e.loadXML("<body xmlns:stream='foo'>"+c+"</body>");return e.documentElement.firstChild};return this._xml_parse(a)}catch(b){Strophe.error("Error : "+
b.message)}return null},_dataRecv:function(a){var b;try{b=this._parseTree(a.data)}catch(c){if(c!="parsererror")throw c;this.disconnect("strophe-parsererror")}if(b!==null){this.xmlInput(b);this.rawInput(a.data);for(var e;this.removeHandlers.length>0;){e=this.removeHandlers.pop();a=this.handlers.indexOf(e);a>=0&&this.handlers.splice(a,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting){this.deleteTimedHandler(this._disconnectTimeout);this._disconnectTimeout=
null;this._doDisconnect()}else{a=b.getAttribute("type");if(a!==null&&a=="terminate"){a=b.getAttribute("condition");b=b.getElementsByTagName("conflict");if(a!==null){if(a=="remote-stream-error"&&b.length>0)a="conflict";this._changeConnectStatus(Strophe.Status.CONNFAIL,a)}else this._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown");this.disconnect()}else{var f;f=this.handlers;this.handlers=[];for(a=0;a<f.length;a++){e=f[a];if(e.isMatch(b)&&(this.authenticated||!e.user))e.run(b)&&this.handlers.push(e);
else this.handlers.push(e)}}}}},_sendTerminate:function(){Strophe.info("_sendTerminate was called");var a={};if(this.authenticated)a=$pres({xmlns:Strophe.NS.CLIENT,type:"unavailable"});this.disconnecting=true;this.send(a)},_connect_cb:function(a){Strophe.info("_connect_cb was called");this.connected=true;this.ws.onmessage=this._dataRecv.bind(this);if(a=a.data){stanza=this._parseTree(a);this.xmlInput(stanza);this.rawInput(Strophe.serialize(stanza));var b=a=false,c=false,e=stanza.getElementsByTagName("mechanism"),
f,g;if(e.length>0)for(f=0;f<e.length;f++){g=Strophe.getText(e[f]);if(g=="DIGEST-MD5")b=true;else if(g=="PLAIN")a=true;else if(g=="ANONYMOUS")c=true}if(Strophe.getNodeFromJid(this.jid)===null&&c){this._changeConnectStatus(Strophe.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("auth",{xmlns:Strophe.NS.SASL,
mechanism:"ANONYMOUS"}).tree())}else if(Strophe.getNodeFromJid(this.jid)===null){this._changeConnectStatus(Strophe.Status.CONNFAIL,"x-strophe-bad-non-anon-jid");this.disconnect()}else if(b){this._changeConnectStatus(Strophe.Status.AUTHENTICATING,null);this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("auth",{xmlns:Strophe.NS.SASL,
mechanism:"DIGEST-MD5"}).tree())}else if(a){a=Strophe.getBareJidFromJid(this.jid);a+="\u0000";a+=Strophe.getNodeFromJid(this.jid);a+="\u0000";a+=this.pass;this._changeConnectStatus(Strophe.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);a=Base64.encode(a);this.send($build("auth",{xmlns:Strophe.NS.SASL,mechanism:"PLAIN"}).t(a).tree())}else{this._changeConnectStatus(Strophe.Status.AUTHENTICATING,
null);this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1");this.send($iq({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:Strophe.NS.AUTH}).c("username",{}).t(Strophe.getNodeFromJid(this.jid)).tree())}}},_rebind_cb:function(a,b,c){this.connected=true;this.ws.onmessage=this._dataRecv.bind(this);if(c=c.data){stanza=this._parseTree(c);this.xmlInput(stanza);this.rawInput(Strophe.serialize(stanza));if(stanza.getElementsByTagName("rebind").length>0){this.send($build("rebind",
{xmlns:"p1:rebind"}).c("jid",{}).t(a).up().c("sid",{}).t(b).tree());this._rebind_success_handler=this._addSysHandler(this._rebind_success_cb.bind(this),null,"rebind",null,null);this._rebind_failure_handler=this._addSysHandler(this._rebind_failure_cb.bind(this),null,"failure",null,null)}else this._changeConnectStatus(Strophe.Status.CONNFAIL,"x-strophe-rebind-not-supported")}},_rebind_success_cb:function(){Strophe.info("Rebinding  succeeded.");this.connected=this.authenticated=true;this.deleteHandler(this._rebind_failure_handler);
this._rebind_failure_handler=null;this._changeConnectStatus(Strophe.Status.ATTACHED,null);return false},_rebind_failure_cb:function(){Strophe.info("Rebinding failed.");if(this._rebind_success_handler){this.deleteHandler(this._rebind_success_handler);this._rebind_success_handler=null}this._changeConnectStatus(Strophe.Status.REBINDFAILED,null);return false},_sasl_challenge1_cb:function(a){var b=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,c=Base64.decode(Strophe.getText(a));a=MD5.hexdigest(Math.random()*1234567890);
var e="",f=null,g="",d;for(this.deleteHandler(this._sasl_failure_handler);c.match(b);){d=c.match(b);c=c.replace(d[0],"");d[2]=d[2].replace(/^"(.+)"$/,"$1");switch(d[1]){case "realm":e=d[2];break;case "nonce":g=d[2];break;case "host":f=d[2]}}b="xmpp/"+this.domain;if(f!==null)b=b+"/"+f;f=MD5.hash(Strophe.getNodeFromJid(this.jid)+":"+e+":"+this.pass)+":"+g+":"+a;c="AUTHENTICATE:"+b;d="";d+="username="+this._quote(Strophe.getNodeFromJid(this.jid))+",";d+="realm="+this._quote(e)+",";d+="nonce="+this._quote(g)+
",";d+="cnonce="+this._quote(a)+",";d+='nc="00000001",';d+='qop="auth",';d+="digest-uri="+this._quote(b)+",";d+="response="+this._quote(MD5.hexdigest(MD5.hexdigest(f)+":"+g+":00000001:"+a+":auth:"+MD5.hexdigest(c)))+",";d+='charset="utf-8"';this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",null,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),
null,"failure",null,null);this.send($build("response",{xmlns:Strophe.NS.SASL}).t(Base64.encode(d)).tree());return false},_quote:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},_sasl_challenge2_cb:function(){this.deleteHandler(this._sasl_success_handler);this.deleteHandler(this._sasl_failure_handler);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),
null,"failure",null,null);this.send($build("response",{xmlns:Strophe.NS.SASL}).tree());return false},_auth1_cb:function(){var a=$iq({type:"set",id:"_auth_2"}).c("query",{xmlns:Strophe.NS.AUTH}).c("username",{}).t(Strophe.getNodeFromJid(this.jid)).up().c("password").t(this.pass);if(!Strophe.getResourceFromJid(this.jid))this.jid=Strophe.getBareJidFromJid(this.jid)+"/strophe";a.up().c("resource",{}).t(Strophe.getResourceFromJid(this.jid));this._addSysHandler(this._auth2_cb.bind(this),null,null,null,
"_auth_2");this.send(a.tree());return false},_sasl_success_cb:function(){Strophe.info("SASL authentication succeeded.");this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null);this.ws.onmessage=this._get_stream_id.bind(this).prependArg(this._dataRecv.bind(this));this._send_initial_stream();
return false},_sasl_auth1_cb:function(a){var b,c;for(b=0;b<a.childNodes.length;b++){c=a.childNodes[b];if(c.nodeName=="bind")this.do_bind=true;if(c.nodeName=="session")this.do_session=true}if(this.do_bind){this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");(a=Strophe.getResourceFromJid(this.jid))?this.send($iq({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Strophe.NS.BIND}).c("resource",{}).t(a).tree()):this.send($iq({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Strophe.NS.BIND}).tree())}else{this._changeConnectStatus(Strophe.Status.AUTHFAIL,
null);return false}return false},_sasl_bind_cb:function(a){if(a.getAttribute("type")=="error"){Strophe.info("SASL binding failed.");this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false}a=a.getElementsByTagName("bind");if(a.length>0){a=a[0].getElementsByTagName("jid");if(a.length>0){this.jid=Strophe.getText(a[0]);if(this.do_session){this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2");this.send($iq({type:"set",id:"_session_auth_2"}).c("session",{xmlns:Strophe.NS.SESSION}).tree())}else{this.authenticated=
true;this._changeConnectStatus(Strophe.Status.CONNECTED,null)}}}else{Strophe.info("SASL binding failed.");this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false}},_sasl_session_cb:function(a){if(a.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(Strophe.Status.CONNECTED,null)}else if(a.getAttribute("type")=="error"){Strophe.info("Session creation failed.");this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false}return false},_sasl_failure_cb:function(){if(this._sasl_success_handler){this.deleteHandler(this._sasl_success_handler);
this._sasl_success_handler=null}if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false},_auth2_cb:function(a){if(a.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(Strophe.Status.CONNECTED,null)}else if(a.getAttribute("type")=="error"){this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);this.disconnect()}return false},_addSysTimedHandler:function(a,
b){var c=new Strophe.TimedHandler(a,b);c.user=false;this.addTimeds.push(c);return c},_addSysHandler:function(a,b,c,e,f){a=new Strophe.Handler(a,b,c,e,f);a.user=false;this.addHandlers.push(a);return a},_onDisconnectTimeout:function(){Strophe.info("_onDisconnectTimeout was called");this._doDisconnect();return false},_onIdle:function(){for(var a,b,c,e;this.removeTimeds.length>0;){b=this.removeTimeds.pop();a=this.timedHandlers.indexOf(b);a>=0&&this.timedHandlers.splice(a,1)}for(;this.addTimeds.length>
0;)this.timedHandlers.push(this.addTimeds.pop());var f=(new Date).getTime();e=[];for(a=0;a<this.timedHandlers.length;a++){b=this.timedHandlers[a];if(this.authenticated||!b.user){c=b.lastCalled+b.period;if(c-f<=0)b.run()&&e.push(b);else e.push(b)}}this.timedHandlers=e;clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}};
Strophe.Connection=function(a){this.service=a;this.jid="";this.rid=Math.floor(Math.random()*4294967295);this.streamId=this.sid=null;this.do_bind=this.do_session=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._disconnectTimeout=this._idleTimeout=null;this.connected=this.disconnecting=this.authenticated=false;this.errors=0;this.paused=false;this.hold=1;this.wait=60;this.window=5;this._data=[];this._requests=[];this._uniqueId=
Math.round(Math.random()*1E4);this._sasl_challenge_handler=this._sasl_failure_handler=this._sasl_success_handler=null;this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var b in Strophe._connectionPlugins)if(Strophe._connectionPlugins.hasOwnProperty(b)){a=function(){};a.prototype=Strophe._connectionPlugins[b];this[b]=new a;this[b].init(this)}};
Strophe.Connection.prototype={reset:function(){this.rid=Math.floor(Math.random()*4294967295);this.streamId=this.sid=null;this.do_bind=this.do_session=false;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this.connected=this.disconnecting=this.authenticated=false;this.errors=0;this._requests=[];this._uniqueId=Math.round(Math.random()*1E4)},pause:function(){this.paused=true},resume:function(){this.paused=false},getUniqueId:function(a){return typeof a==
"string"||typeof a=="number"?++this._uniqueId+":"+a:++this._uniqueId+""},connect:function(a,b,c,e,f){this.jid=a;this.pass=b;this.connect_callback=c;this.authenticated=this.connected=this.disconnecting=false;this.errors=0;this.wait=e||this.wait;this.hold=f||this.hold;this.domain=Strophe.getDomainFromJid(this.jid);a=this._buildBody().attrs({to:this.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Strophe.NS.BOSH});this._changeConnectStatus(Strophe.Status.CONNECTING,
null);this._requests.push(new Strophe.Request(a.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),a.tree().rid));this._throttledRequestHandler()},attach:function(a,b,c,e,f,g,d){this.jid=a;this.sid=b;this.rid=c;this.connect_callback=e;this.domain=Strophe.getDomainFromJid(this.jid);this.connected=this.authenticated=true;this.wait=f||this.wait;this.hold=g||this.hold;this.window=d||this.window;this._changeConnectStatus(Strophe.Status.ATTACHED,null)},xmlInput:function(){},
xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},send:function(a){if(a!==null){if(typeof a.sort==="function")for(var b=0;b<a.length;b++)this._queueData(a[b]);else typeof a.tree==="function"?this._queueData(a.tree()):this._queueData(a);this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}},flush:function(){clearTimeout(this._idleTimeout);this._onIdle()},sendIQ:function(a,b,c,e){var f=null,g=this;if(typeof a.tree===
"function")a=a.tree();var d=a.getAttribute("id");if(!d){d=this.getUniqueId("sendIQ");a.setAttribute("id",d)}var h=this.addHandler(function(l){f&&g.deleteTimedHandler(f);var s=l.getAttribute("type");if(s=="result")b&&b(l);else if(s=="error")c&&c(l);else throw{name:"StropheError",message:"Got bad IQ type of "+s};},null,"iq",null,d);if(e)f=this.addTimedHandler(e,function(){g.deleteHandler(h);c&&c(null);return false});this.send(a);return d},_queueData:function(a){if(a===null||!a.tagName||!a.childNodes)throw{name:"StropheError",
message:"Cannot queue non-DOMElement."};this._data.push(a)},_sendRestart:function(){this._data.push("restart");this._throttledRequestHandler();clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(a,b){var c=new Strophe.TimedHandler(a,b);this.addTimeds.push(c);return c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,c,e,f,g,d){a=new Strophe.Handler(a,b,c,e,f,g,d);this.addHandlers.push(a);return a},deleteHandler:function(a){this.removeHandlers.push(a)},
disconnect:function(a){this._changeConnectStatus(Strophe.Status.DISCONNECTING,a);Strophe.info("Disconnect was called because: "+a);if(this.connected){this._disconnectTimeout=this._addSysTimedHandler(3E3,this._onDisconnectTimeout.bind(this));this._sendTerminate()}},_changeConnectStatus:function(a,b){for(var c in Strophe._connectionPlugins)if(Strophe._connectionPlugins.hasOwnProperty(c)){var e=this[c];if(e.statusChanged)try{e.statusChanged(a,b)}catch(f){Strophe.error(""+c+" plugin caused an exception changing status: "+
f)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(g){Strophe.error("User connection callback caused an exception: "+g)}},_buildBody:function(){var a=$build("body",{rid:this.rid++,xmlns:Strophe.NS.HTTPBIND});this.sid!==null&&a.attrs({sid:this.sid});return a},_removeRequest:function(a){Strophe.debug("removing request");var b;for(b=this._requests.length-1;b>=0;b--)a==this._requests[b]&&this._requests.splice(b,1);a.xhr.onreadystatechange=function(){};this._throttledRequestHandler()},_restartRequest:function(a){var b=
this._requests[a];if(b.dead===null)b.dead=new Date;this._processRequest(a)},_processRequest:function(a){var b=this._requests[a],c=-1;try{if(b.xhr.readyState==4)c=b.xhr.status}catch(e){Strophe.error("caught an error in _requests["+a+"], reqStatus: "+c)}if(typeof c=="undefined")c=-1;var f=b.age();f=!isNaN(f)&&f>Math.floor(Strophe.TIMEOUT*this.wait);var g=b.dead!==null&&b.timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait);c=b.xhr.readyState==4&&(c<1||c>=500);if(f||g||c){g&&Strophe.error("Request "+
this._requests[a].id+" timed out (secondary), restarting");b.abort=true;b.xhr.abort();b.xhr.onreadystatechange=function(){};this._requests[a]=new Strophe.Request(b.xmlData,b.origFunc,b.rid,b.sends);b=this._requests[a]}if(b.xhr.readyState===0){Strophe.debug("request id "+b.id+"."+b.sends+" posting");b.date=new Date;try{b.xhr.open("POST",this.service,true)}catch(d){Strophe.error("XHR open failed.");this.connected||this._changeConnectStatus(Strophe.Status.CONNFAIL,"bad-service");this.disconnect();return}a=
function(){b.xhr.send(b.data)};b.sends>1?setTimeout(a,Math.pow(b.sends,3)*1E3):a();b.sends++;this.xmlOutput(b.xmlData);this.rawOutput(b.data)}else Strophe.debug("_processRequest: "+(a===0?"first":"second")+" request has readyState of "+b.xhr.readyState)},_throttledRequestHandler:function(){this._requests?Strophe.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):Strophe.debug("_throttledRequestHandler called with undefined requests");if(!(!this._requests||this._requests.length===
0)){this._requests.length>0&&this._processRequest(0);this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window-1&&this._processRequest(1)}},_onRequestStateChange:function(a,b){Strophe.debug("request id "+b.id+"."+b.sends+" state changed to "+b.xhr.readyState);if(b.abort)b.abort=false;else{var c;if(b.xhr.readyState==4){c=0;try{c=b.xhr.status}catch(e){}if(typeof c=="undefined")c=0;if(this.disconnecting)if(c>=400){this._hitError(c);return}var f=this._requests[0]==b,g=
this._requests[1]==b;if(c>0&&c<500||b.sends>5){this._removeRequest(b);Strophe.debug("request id "+b.id+" should now be removed")}if(c==200){if(g||f&&this._requests.length>0&&this._requests[0].age()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait))this._restartRequest(0);Strophe.debug("request id "+b.id+"."+b.sends+" got 200");a(b);this.errors=0}else{Strophe.error("request id "+b.id+"."+b.sends+" error "+c+" happened");if(c===0||c>=400&&c<600||c>=12E3){this._hitError(c);if(c>=400&&c<500){this._changeConnectStatus(Strophe.Status.DISCONNECTING,
null);this._doDisconnect()}}}c>0&&c<1E4||b.sends>5||this._throttledRequestHandler()}}},_hitError:function(a){this.errors++;Strophe.warn("request errored, status: "+a+", number of errors: "+this.errors);this.errors>4&&this._onDisconnectTimeout()},_doDisconnect:function(){Strophe.info("_doDisconnect was called");this.disconnecting=this.authenticated=false;this.streamId=this.sid=null;this.rid=Math.floor(Math.random()*4294967295);if(this.connected){this._changeConnectStatus(Strophe.Status.DISCONNECTED,
null);this.connected=false}this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[]},_dataRecv:function(a){try{var b=a.getResponse()}catch(c){if(c!="parsererror")throw c;this.disconnect("strophe-parsererror")}if(b!==null){this.xmlInput(b);for(this.rawInput(Strophe.serialize(b));this.removeHandlers.length>0;){a=this.removeHandlers.pop();a=this.handlers.indexOf(a);a>=0&&this.handlers.splice(a,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());
if(this.disconnecting&&this._requests.length===0){this.deleteTimedHandler(this._disconnectTimeout);this._disconnectTimeout=null;this._doDisconnect()}else{a=b.getAttribute("type");if(a!==null&&a=="terminate"){a=b.getAttribute("condition");b=b.getElementsByTagName("conflict");if(a!==null){if(a=="remote-stream-error"&&b.length>0)a="conflict";this._changeConnectStatus(Strophe.Status.CONNFAIL,a)}else this._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown");this.disconnect()}else{var e=this;Strophe.forEachChild(b,
null,function(f){var g,d;d=e.handlers;e.handlers=[];for(g=0;g<d.length;g++){var h=d[g];if(h.isMatch(f)&&(e.authenticated||!h.user))h.run(f)&&e.handlers.push(h);else e.handlers.push(h)}})}}}},_sendTerminate:function(){Strophe.info("_sendTerminate was called");var a=this._buildBody().attrs({type:"terminate"});this.authenticated&&a.c("presence",{xmlns:Strophe.NS.CLIENT,type:"unavailable"});this.disconnecting=true;this._requests.push(new Strophe.Request(a.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),
a.tree().getAttribute("rid")));this._throttledRequestHandler()},_connect_cb:function(a){Strophe.info("_connect_cb was called");this.connected=true;if(a=a.getResponse()){this.xmlInput(a);this.rawInput(Strophe.serialize(a));var b=a.getAttribute("type");if(b!==null&&b=="terminate"){b=a.getAttribute("condition");a=a.getElementsByTagName("conflict");if(b!==null){if(b=="remote-stream-error"&&a.length>0)b="conflict";this._changeConnectStatus(Strophe.Status.CONNFAIL,b)}else this._changeConnectStatus(Strophe.Status.CONNFAIL,
"unknown")}else{if(!this.sid)this.sid=a.getAttribute("sid");if(!this.stream_id)this.stream_id=a.getAttribute("authid");if(b=a.getAttribute("requests"))this.window=parseInt(b,10);if(b=a.getAttribute("hold"))this.hold=parseInt(b,10);if(b=a.getAttribute("wait"))this.wait=parseInt(b,10);var c=b=false,e=false;a=a.getElementsByTagName("mechanism");var f,g;if(a.length>0){for(f=0;f<a.length;f++){g=Strophe.getText(a[f]);if(g=="DIGEST-MD5")c=true;else if(g=="PLAIN")b=true;else if(g=="ANONYMOUS")e=true}if(Strophe.getNodeFromJid(this.jid)===
null&&e){this._changeConnectStatus(Strophe.Status.AUTHENTICATING,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("auth",{xmlns:Strophe.NS.SASL,mechanism:"ANONYMOUS"}).tree())}else if(Strophe.getNodeFromJid(this.jid)===null){this._changeConnectStatus(Strophe.Status.CONNFAIL,"x-strophe-bad-non-anon-jid");this.disconnect()}else if(c){this._changeConnectStatus(Strophe.Status.AUTHENTICATING,
null);this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("auth",{xmlns:Strophe.NS.SASL,mechanism:"DIGEST-MD5"}).tree())}else if(b){a=Strophe.getBareJidFromJid(this.jid);a+="\u0000";a+=Strophe.getNodeFromJid(this.jid);a+="\u0000";a+=this.pass;this._changeConnectStatus(Strophe.Status.AUTHENTICATING,null);this._sasl_success_handler=
this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);a=Base64.encode(a);this.send($build("auth",{xmlns:Strophe.NS.SASL,mechanism:"PLAIN"}).t(a).tree())}else{this._changeConnectStatus(Strophe.Status.AUTHENTICATING,null);this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1");this.send($iq({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:Strophe.NS.AUTH}).c("username",
{}).t(Strophe.getNodeFromJid(this.jid)).tree())}}else{a=this._buildBody();this._requests.push(new Strophe.Request(a.tree(),this._onRequestStateChange.bind(this).prependArg(this._connect_cb.bind(this)),a.tree().getAttribute("rid")));this._throttledRequestHandler()}}}},_sasl_challenge1_cb:function(a){var b=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,c=Base64.decode(Strophe.getText(a));a=MD5.hexdigest(Math.random()*1234567890);var e="",f=null,g="",d;for(this.deleteHandler(this._sasl_failure_handler);c.match(b);){d=
c.match(b);c=c.replace(d[0],"");d[2]=d[2].replace(/^"(.+)"$/,"$1");switch(d[1]){case "realm":e=d[2];break;case "nonce":g=d[2];break;case "host":f=d[2]}}b="xmpp/"+this.domain;if(f!==null)b=b+"/"+f;f=MD5.hash(Strophe.getNodeFromJid(this.jid)+":"+e+":"+this.pass)+":"+g+":"+a;c="AUTHENTICATE:"+b;d="";d+="username="+this._quote(Strophe.getNodeFromJid(this.jid))+",";d+="realm="+this._quote(e)+",";d+="nonce="+this._quote(g)+",";d+="cnonce="+this._quote(a)+",";d+='nc="00000001",';d+='qop="auth",';d+="digest-uri="+
this._quote(b)+",";d+="response="+this._quote(MD5.hexdigest(MD5.hexdigest(f)+":"+g+":00000001:"+a+":auth:"+MD5.hexdigest(c)))+",";d+='charset="utf-8"';this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",null,null);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("response",
{xmlns:Strophe.NS.SASL}).t(Base64.encode(d)).tree());return false},_quote:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},_sasl_challenge2_cb:function(){this.deleteHandler(this._sasl_success_handler);this.deleteHandler(this._sasl_failure_handler);this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);this.send($build("response",
{xmlns:Strophe.NS.SASL}).tree());return false},_auth1_cb:function(){var a=$iq({type:"set",id:"_auth_2"}).c("query",{xmlns:Strophe.NS.AUTH}).c("username",{}).t(Strophe.getNodeFromJid(this.jid)).up().c("password").t(this.pass);if(!Strophe.getResourceFromJid(this.jid))this.jid=Strophe.getBareJidFromJid(this.jid)+"/strophe";a.up().c("resource",{}).t(Strophe.getResourceFromJid(this.jid));this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2");this.send(a.tree());return false},_sasl_success_cb:function(){Strophe.info("SASL authentication succeeded.");
this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);this._sasl_challenge_handler=null}this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null);this._sendRestart();return false},_sasl_auth1_cb:function(a){var b,c;for(b=0;b<a.childNodes.length;b++){c=a.childNodes[b];if(c.nodeName=="bind")this.do_bind=true;if(c.nodeName=="session")this.do_session=true}if(this.do_bind){this._addSysHandler(this._sasl_bind_cb.bind(this),
null,null,null,"_bind_auth_2");(a=Strophe.getResourceFromJid(this.jid))?this.send($iq({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Strophe.NS.BIND}).c("resource",{}).t(a).tree()):this.send($iq({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:Strophe.NS.BIND}).tree())}else{this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false}return false},_sasl_bind_cb:function(a){if(a.getAttribute("type")=="error"){Strophe.info("SASL binding failed.");this._changeConnectStatus(Strophe.Status.AUTHFAIL,
null);return false}a=a.getElementsByTagName("bind");if(a.length>0){a=a[0].getElementsByTagName("jid");if(a.length>0){this.jid=Strophe.getText(a[0]);if(this.do_session){this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2");this.send($iq({type:"set",id:"_session_auth_2"}).c("session",{xmlns:Strophe.NS.SESSION}).tree())}else{this.authenticated=true;this._changeConnectStatus(Strophe.Status.CONNECTED,null)}}}else{Strophe.info("SASL binding failed.");this._changeConnectStatus(Strophe.Status.AUTHFAIL,
null);return false}},_sasl_session_cb:function(a){if(a.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(Strophe.Status.CONNECTED,null)}else if(a.getAttribute("type")=="error"){Strophe.info("Session creation failed.");this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false}return false},_sasl_failure_cb:function(){if(this._sasl_success_handler){this.deleteHandler(this._sasl_success_handler);this._sasl_success_handler=null}if(this._sasl_challenge_handler){this.deleteHandler(this._sasl_challenge_handler);
this._sasl_challenge_handler=null}this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);return false},_auth2_cb:function(a){if(a.getAttribute("type")=="result"){this.authenticated=true;this._changeConnectStatus(Strophe.Status.CONNECTED,null)}else if(a.getAttribute("type")=="error"){this._changeConnectStatus(Strophe.Status.AUTHFAIL,null);this.disconnect()}return false},_addSysTimedHandler:function(a,b){var c=new Strophe.TimedHandler(a,b);c.user=false;this.addTimeds.push(c);return c},_addSysHandler:function(a,
b,c,e,f){a=new Strophe.Handler(a,b,c,e,f);a.user=false;this.addHandlers.push(a);return a},_onDisconnectTimeout:function(){Strophe.info("_onDisconnectTimeout was called");for(var a;this._requests.length>0;){a=this._requests.pop();a.abort=true;a.xhr.abort();a.xhr.onreadystatechange=function(){}}this._doDisconnect();return false},_onIdle:function(){for(var a,b,c,e;this.removeTimeds.length>0;){b=this.removeTimeds.pop();a=this.timedHandlers.indexOf(b);a>=0&&this.timedHandlers.splice(a,1)}for(;this.addTimeds.length>
0;)this.timedHandlers.push(this.addTimeds.pop());var f=(new Date).getTime();e=[];for(a=0;a<this.timedHandlers.length;a++){b=this.timedHandlers[a];if(this.authenticated||!b.user){c=b.lastCalled+b.period;if(c-f<=0)b.run()&&e.push(b);else e.push(b)}}this.timedHandlers=e;if(this.authenticated&&this._requests.length===0&&this._data.length===0&&!this.disconnecting){Strophe.info("no requests during idle cycle, sending blank request");this._data.push(null)}if(this._requests.length<2&&this._data.length>0&&
!this.paused){b=this._buildBody();for(a=0;a<this._data.length;a++)if(this._data[a]!==null)this._data[a]==="restart"?b.attrs({to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Strophe.NS.BOSH}):b.cnode(this._data[a]).up();delete this._data;this._data=[];this._requests.push(new Strophe.Request(b.tree(),this._onRequestStateChange.bind(this).prependArg(this._dataRecv.bind(this)),b.tree().rid));this._processRequest(this._requests.length-1)}if(this._requests.length>0){a=this._requests[0].age();
this._requests[0].dead!==null&&this._requests[0].timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler();if(a>Math.floor(Strophe.TIMEOUT*this.wait)){Strophe.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Strophe.TIMEOUT*this.wait)+" seconds since last activity");this._throttledRequestHandler()}}clearTimeout(this._idleTimeout);this._idleTimeout=setTimeout(this._onIdle.bind(this),100)}};
Strophe.addConnectionPlugin("pubsub",{_connection:null,init:function(a){this._connection=a;Strophe.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub");Strophe.addNamespace("PUBSUB_SUBSCRIBE_OPTIONS",Strophe.NS.PUBSUB+"#subscribe_options");Strophe.addNamespace("PUBSUB_ERRORS",Strophe.NS.PUBSUB+"#errors");Strophe.addNamespace("PUBSUB_EVENT",Strophe.NS.PUBSUB+"#event");Strophe.addNamespace("PUBSUB_OWNER",Strophe.NS.PUBSUB+"#owner");Strophe.addNamespace("PUBSUB_AUTO_CREATE",Strophe.NS.PUBSUB+"#auto-create");
Strophe.addNamespace("PUBSUB_PUBLISH_OPTIONS",Strophe.NS.PUBSUB+"#publish-options");Strophe.addNamespace("PUBSUB_NODE_CONFIG",Strophe.NS.PUBSUB+"#node_config");Strophe.addNamespace("PUBSUB_CREATE_AND_CONFIGURE",Strophe.NS.PUBSUB+"#create-and-configure");Strophe.addNamespace("PUBSUB_SUBSCRIBE_AUTHORIZATION",Strophe.NS.PUBSUB+"#subscribe_authorization");Strophe.addNamespace("PUBSUB_GET_PENDING",Strophe.NS.PUBSUB+"#get-pending");Strophe.addNamespace("PUBSUB_MANAGE_SUBSCRIPTIONS",Strophe.NS.PUBSUB+"#manage-subscriptions");
Strophe.addNamespace("PUBSUB_META_DATA",Strophe.NS.PUBSUB+"#meta-data")},createNode:function(a,b,c,e,f){var g=this._connection.getUniqueId("pubsubcreatenode");a=$iq({from:a,to:b,type:"set",id:g});b=Strophe.xmlElement("configure",[]);var d=Strophe.xmlElement("x",[["xmlns","jabber:x:data"]]),h=Strophe.xmlElement("field",[["var","FORM_TYPE"],["type","hidden"]]),l=Strophe.xmlElement("value",[]),s=Strophe.xmlTextNode(Strophe.NS.PUBSUB+"#node_config");l.appendChild(s);h.appendChild(l);d.appendChild(h);
for(var y in e)d.appendChild(e[y]);e.length&&e.length!=0&&b.appendChild(d);a.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("create",{node:c}).up().cnode(b);this._connection.addHandler(f,null,"iq",null,g,null);this._connection.send(a.tree());return g},subscribe:function(a,b,c,e,f){var g=this._connection.getUniqueId("subscribenode"),d=Strophe.xmlElement("options",[]),h=Strophe.xmlElement("x",[["xmlns","jabber:x:data"]]),l=Strophe.xmlElement("field",[["var","FORM_TYPE"],["type","hidden"]]),s=Strophe.xmlElement("value",
[]),y=Strophe.xmlTextNode(Strophe.NS.PUBSUB_SUBSCRIBE_OPTIONS);s.appendChild(y);l.appendChild(s);h.appendChild(l);b=$iq({from:a,to:b,type:"set",id:g});if(e&&e.length&&e.length!==0){for(l=0;l<e.length;l++)h.appendChild(e[l]);d.appendChild(h);b.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("subscribe",{node:c,jid:a}).up().cnode(d)}else b.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("subscribe",{node:c,jid:a});this._connection.addHandler(f,null,"iq",null,g,null);this._connection.send(b.tree());return g},unsubscribe:function(a,
b,c,e){var f=this._connection.getUniqueId("unsubscribenode");b=$iq({from:a,to:b,type:"set",id:f});b.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("unsubscribe",{node:c,jid:a});this._connection.addHandler(e,null,"iq",null,f,null);this._connection.send(b.tree());return f},publish:function(a,b,c,e,f){var g=this._connection.getUniqueId("publishnode");c=Strophe.xmlElement("publish",[["node",c],["jid",a]]);for(var d in e){var h=Strophe.xmlElement("item",[["id",e[d].id]]);h.appendChild(e[d].value[0]);c.appendChild(h)}a=
$iq({from:a,to:b,type:"set",id:g});a.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).cnode(c);this._connection.addHandler(f,null,"iq",null,g,null);this._connection.send(a.tree());return g},items:function(a,b,c,e,f,g){a=$iq({from:a,to:b,type:"get"});a.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("items",{node:c,max_items:e});return this._connection.sendIQ(a.tree(),f,g)},item:function(a,b,c,e,f,g){a=$iq({from:a,to:b,type:"get"});a.c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("items",{node:c}).c("item",{id:e});return this._connection.sendIQ(a.tree(),
f,g)}});
PushClient.prototype={connect:function(a){var b=this;if(this.connection&&this.connection.connected)this.console.log(this.connection,"already connected");else{this._check_rebind();var c=0;if(this.retries==0&&a===undefined)c=this.params.connect_delay;setTimeout(function(){this.retries++;if(this.retries>this.params.connectretry)this.console.log(this.params.connectretry+" connect retry exceeded");else{this.timeout_id=setTimeout(function(){b.connect(b.params,true)},this.params.connect_timeout);if(!a&&
this.params.ws_url&&window.WebSocket){this.current_protocol="WEBSOCKET";this.websocket()}else{this.current_protocol="BOSH";this.bosh()}}}.bind(this),c)}},disconnect:function(){this.closing=true;window.clearTimeout(this.timeout_id);this.rebind_delete();this.connection&&this.connection.disconnect()},bosh:function(){try{this.connection=new Strophe.Connection(this.params.bosh_url);var a=this.rebind_fetch();if(a&&this.params.rebind){prev_connection=a.split(" ");prev_connection[0]=="BOSH"?this.connection.attach(prev_connection[1],
prev_connection[2],prev_connection[3],this.conn_callback.bind(this)):this._transport_connect()}else this._transport_connect()}catch(b){this.connect()}},websocket:function(){try{this.connection=new Strophe.WebSocket(this.params.ws_url);var a=this.rebind_fetch();if(a&&this.params.rebind){prev_connection=a.split(" ");this.connection.rebind(prev_connection[1],prev_connection[2],this.conn_callback.bind(this))}else this._transport_connect()}catch(b){this.rebind_delete();this.connect()}},_transport_connect:function(){this.connection.connect(this.params.jid?
this.params.jid:this.params.domain,this.params.password?this.params.password:"",this.conn_callback.bind(this))},_check_rebind:function(){if(this.params.rebind){var a=this.rebind_fetch();if(a&&this.params.jid&&this.params.jid!==""){a.split(" ");var b=Strophe.getBareJidFromJid(this.params.jid);a=Strophe.getBareJidFromJid(a.split(" ")[1]);b!=a&&this.rebind_delete()}}},conn_callback:function(a){var b=this;if(this.params.debug){this.connection.rawOutput=function(c){b.console.log("out -> "+c)};this.connection.rawInput=
function(c){b.console.log("in <- "+c)}}window.clearTimeout(this.timeout_id);this.connection.addTimedHandler(2E3,function(){if(b.current_protocol==="BOSH"){var c=["BOSH",b.connection.jid,b.connection.sid,b.connection.rid].join(" ");b.rebind_store(c)}return true});this.params.on_strophe_event(a,this.connection);if(a===Strophe.Status.CONNECTED){this.retries=0;this.params.rebind==true&&this.current_protocol=="WEBSOCKET"&&this.connection.save(function(){var c=["WEBSOCKET",b.connection.jid,b.connection.streamId].join(" ");
b.rebind_store(c)},function(){});this.subscribe()}else if(a===Strophe.Status.ATTACHED)this.current_protocol=="WEBSOCKET"?this.subscribe():setTimeout(function(){nodes=b.params.nodes;for(var c in nodes)typeof nodes[c]=="string"&&b.params.num_old>0&&b.connection.pubsub.items(b.connection.jid,b.params.pubsub_domain,nodes[c],b.params.num_old,function(e){e=e.getElementsByTagName("item");for(var f=0;f<e.length;f++){id=e[f].getAttribute("id");b.params.publish(id,e[f].firstChild)}});b.connection.addHandler(b.on_event.bind(b),
null,"message",null,null,b.params.pubsub_domain)},100);else if(!this.closing&&(a===Strophe.Status.CONNFAIL||a===Strophe.Status.DISCONNECTED)){b=this;a=Math.round(Math.random()*this.params.connect_timeout*(this.retries+1));b.rebind_delete();this.timeout_id=setTimeout(function(){b.connect(b.params)},a)}else if(a===Strophe.Status.REBINDFAILED){this.rebind_delete();this.websocket()}},subscribe:function(a){if(a===undefined)a=this.params.nodes;for(var b in a)if(typeof a[b]=="string"){if(this.params.num_old>
0){var c=this;this.connection.pubsub.items(this.connection.jid,this.params.pubsub_domain,a[b],this.params.num_old,function(e){e=e.getElementsByTagName("item");for(var f=0;f<e.length;f++){id=e[f].getAttribute("id");c.params.publish(id,e[f].firstChild)}})}this.connection.pubsub.subscribe(this.connection.jid,this.params.pubsub_domain,a[b],[],function(){})}this.connection.addHandler(this.on_event.bind(this),null,"message",null,null,this.params.pubsub_domain)},unsubscribe:function(a){if(a===undefined)a=
this.params.nodes;for(var b in a)typeof a[b]=="string"&&this.connection.pubsub.unsubscribe(this.connection.jid,this.params.pubsub_domain,a[b],function(){})},on_event:function(a){for(var b=a.getElementsByTagName("retract"),c=b.length,e=0;e<c;e++)this.params.retract(b[e].getAttribute("id"));b=undefined;c=a.getElementsByTagName("delay");if(c.length)b=c[0].getAttribute("stamp");a=a.getElementsByTagName("items");c=a.length;var f,g,d;for(e=0;e<c;e++){f=a[e].getAttribute("node");g=a[e].getElementsByTagName("item");
d=g.length;for(e=0;e<d;e++)this.params.publish(g[e].getAttribute("id"),g[e].firstChild,f,b)}return true},cookie:function(a,b){if(typeof b!="undefined"){options=this.params.cookie_opts;if(b===null){b="";options.expires=-1}var c="";if(options.expires&&(typeof options.expires=="number"||options.expires.toUTCString)){if(typeof options.expires=="number"){c=new Date;c.setTime(c.getTime()+options.expires*24*60*60*1E3)}else c=options.expires;c="; expires="+c.toUTCString()}var e=options.path?"; path="+options.path:
"",f=options.domain?"; domain="+options.domain:"",g=options.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),c,e,f,g].join("")}else{c=null;if(document.cookie&&document.cookie!=""){e=document.cookie.split(";");for(f=0;f<e.length;f++){g=function(d){if(typeof String.trim==="function")return(d||"").trim();return(d||"").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}(e[f]);if(g.substring(0,a.length+1)==a+"="){c=decodeURIComponent(g.substring(a.length+1));break}}}return c}},rebind_store:function(a){var b=
this._build_key();if(window.sessionStorage)sessionStorage[b]=a;else this.cookie(b,a)},rebind_delete:function(){var a=this._build_key();window.sessionStorage?sessionStorage.removeItem(a):this.cookie(a,null)},rebind_fetch:function(){var a=this._build_key();return window.sessionStorage?sessionStorage[a]:this.cookie(a)},_build_key:function(){var a=PushClient.COOKIE+"_"+this.current_protocol;if(this.current_protocol==="BOSH")a=a+"_"+this.scope;return a}};
var Mustache=function(){var a=function(){};a.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(b,c,e,f){if(!f){this.context=c;this.buffer=[]}if(!this.includes("",b))if(f)return b;else{this.send(b);return}b=this.render_pragmas(b);b=this.render_section(b,c,e);if(f)return this.render_tags(b,c,e,f);this.render_tags(b,c,e,f)},send:function(b){b!=""&&this.buffer.push(b)},render_pragmas:function(b){if(!this.includes("%",b))return b;
var c=this;return b.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(e,f,g){if(!c.pragmas_implemented[f])throw{message:"This implementation of mustache doesn't understand the '"+f+"' pragma"};c.pragmas[f]={};if(g){e=g.split("=");c.pragmas[f][e[0]]=e[1]}return""})},render_partial:function(b,c,e){b=this.trim(b);if(!e||e[b]===undefined)throw{message:"unknown_partial '"+b+"'"};if(typeof c[b]!="object")return this.render(e[b],c,e,true);return this.render(e[b],c[b],e,true)},render_section:function(b,
c,e){if(!this.includes("#",b)&&!this.includes("^",b))return b;var f=this;return b.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(g,d,h,l){g=f.find(h,c);if(d=="^")return!g||f.is_array(g)&&g.length===0?f.render(l,c,e,true):"";else if(d=="#")return f.is_array(g)?f.map(g,function(s){return f.render(l,f.create_context(s),e,true)}).join(""):f.is_object(g)?f.render(l,f.create_context(g),e,true):typeof g==="function"?
g.call(c,l,function(s){return f.render(s,c,e,true)}):g?f.render(l,c,e,true):""})},render_tags:function(b,c,e,f){var g=this,d=function(){return RegExp(g.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+g.ctag+"+","g")},h=d(),l=function(y,k,u){switch(k){case "!":return"";case "=":g.set_delimiters(u);h=d();return"";case ">":return g.render_partial(u,c,e);case "{":return g.find(u,c);default:return g.escape(g.find(u,c))}};b=b.split("\n");for(var s=0;s<b.length;s++){b[s]=b[s].replace(h,l,this);f||this.send(b[s])}if(f)return b.join("\n")},
set_delimiters:function(b){b=b.split(" ");this.otag=this.escape_regex(b[0]);this.ctag=this.escape_regex(b[1])},escape_regex:function(b){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return b.replace(arguments.callee.sRE,"\\$1")},find:function(b,c){b=this.trim(b);var e;if(c[b]===false||c[b]===0||c[b])e=c[b];else if(this.context[b]===false||this.context[b]===0||this.context[b])e=this.context[b];if(typeof e==="function")return e.apply(c);
if(e!==undefined)return e;return""},includes:function(b,c){return c.indexOf(this.otag+b)!=-1},escape:function(b){b=String(b===null?"":b);return b.replace(/&(?!\w+;)|["'<>\\]/g,function(c){switch(c){case "&":return"&amp;";case "\\":return"\\\\";case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return c}})},create_context:function(b){if(this.is_object(b))return b;else{var c=".";if(this.pragmas["IMPLICIT-ITERATOR"])c=this.pragmas["IMPLICIT-ITERATOR"].iterator;
var e={};e[c]=b;return e}},is_object:function(b){return b&&typeof b=="object"},is_array:function(b){return Object.prototype.toString.call(b)==="[object Array]"},trim:function(b){return b.replace(/^\s*|\s*$/g,"")},map:function(b,c){if(typeof b.map=="function")return b.map(c);else{for(var e=[],f=b.length,g=0;g<f;g++)e.push(c(b[g]));return e}}};return{name:"mustache.js",version:"0.3.1-dev",to_html:function(b,c,e,f){var g=new a;if(f)g.send=f;g.render(b,c,e);if(!f)return g.buffer.join("\n")}}}(),GithubPush_default=
{template:"<li class='gh_commit' id='{{id}}'><a class='gh_author' href='https://github.com/{{username}}'><img src=' http://www.gravatar.com/avatar/{{avatarhash}}?s=70'/>{{name}}</a><div class='push'><h5><a href='{{repository_link}}'>{{repository_name}}</a></h5><h4><a href='{{link}}'>{{title}}</a></h4><abbr class='timeago' title='{{time}}'>{{time}}</abbr></div><pre>{{message}}</pre><a class='watermark' href='http://gitlive.com'>GitLive</a></li>",css:"http://gitlive.com/githublive.css",bookmarklet:false};
(function(a,b,c,e){var f,g,d=false;if(!(f=a.jQuery)||c>f.fn.jquery||e(f,d)){var h=b.createElement("script");h.type="text/javascript";h.src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.js";h.onload=h.onreadystatechange=function(){if(!d&&(!(g=this.readyState)||g=="loaded"||g=="complete")){e((f=a.jQuery).noConflict(1),d=true);f(h).remove()}};b.documentElement.childNodes[0].appendChild(h)}})(window,document,"1.4",function(a){function b(){var f;f=this;f=a(f);if(!f.data("timeago")){f.data("timeago",
{datetime:e.datetime(f)});var g=a.trim(f.text());g.length>0&&f.attr("title",g)}f=f.data("timeago");isNaN(f.datetime)||a(this).text(c(f.datetime));return this}function c(f){return e.inWords((new Date).getTime()-f.getTime())}a(function(){GithubPush=a.extend(GithubPush_default,GithubPush);a("head").append(a("<link>").attr({type:"text/css",rel:"stylesheet",href:GithubPush.css}));GithubPush.bookmarklet&&a("#commits").addClass("gh_bookmarklet");a("#commits").append(a("<ul/>"));PushClient.connect({nodes:GithubPush.nodes,
rebind:true,flash_location:"http://gitlive.com/WebSocketMain.swf",ws_url:"ws://gitlive.com:5281/xmpp",bosh_url:"http://gitlive.com/http-bind",domain:"gitlive.com",debug:false,connectretry:5,publish:function(f,g){var d=a(g);if(!a("#"+f).length){var h=d.find("author"),l=h.find("email").text(),s=d.find("github\\:repository").attr("name");if(s===undefined)s=d.find("repository").attr("name");d={id:f,link:d.find("link[rel=canonical]").attr("src"),title:d.find("title").text().substr(0,8),message:d.find("content").text(),
time:d.find("published").text(),email:l,name:h.find("name").text(),username:h.find("username").text(),avatarhash:MD5.hexdigest(l),repository_link:d.find("link[rel=project]").attr("src"),repository_name:s};d=Mustache.to_html(GithubPush.template,d);a("#commits > ul").append(d);a("abbr.timeago").timeago();return true}},num_old:GithubPush.num_old})});a.timeago=function(f){return f instanceof Date?c(f):typeof f=="string"?c(a.timeago.parse(f)):c(a.timeago.datetime(f))};var e=a.timeago;a.extend(a.timeago,
{settings:{refreshMillis:6E4,allowFuture:false,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},inWords:function(f){function g(n,m){return(a.isFunction(n)?n(m,f):n).replace(/%d/i,d.numbers&&d.numbers[m]||m)}var d=this.settings.strings,
h=d.prefixAgo,l=d.suffixAgo;if(this.settings.allowFuture){if(f<0){h=d.prefixFromNow;l=d.suffixFromNow}f=Math.abs(f)}var s=f/1E3,y=s/60,k=y/60,u=k/24,j=u/365;s=s<45&&g(d.seconds,Math.round(s))||s<90&&g(d.minute,1)||y<45&&g(d.minutes,Math.round(y))||y<90&&g(d.hour,1)||k<24&&g(d.hours,Math.round(k))||k<48&&g(d.day,1)||u<30&&g(d.days,Math.floor(u))||u<60&&g(d.month,1)||u<365&&g(d.months,Math.floor(u/30))||j<2&&g(d.year,1)||g(d.years,Math.floor(j));return a.trim([h,s,l].join(" "))},parse:function(f){f=
a.trim(f);f=f.replace(/\.\d\d\d+/,"");f=f.replace(/-/,"/").replace(/-/,"/");f=f.replace(/T/," ").replace(/Z/," UTC");f=f.replace(/([\+-]\d\d)\:?(\d\d)/," $1$2");return new Date(f)},datetime:function(f){f=a(f).get(0).tagName.toLowerCase()=="time"?a(f).attr("datetime"):a(f).attr("title");return e.parse(f)}});a.fn.timeago=function(){var f=this;f.each(b);var g=e.settings;g.refreshMillis>0&&setInterval(function(){f.each(b)},g.refreshMillis);return f};document.createElement("abbr");document.createElement("time")});
